{% extends 'layout.html' %}
{% load tags %}
{% load frontend_tags %}
{% load static %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/adjustments.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/libraries.css' %}">
{% endblock %}
{% block content %}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-8">
        <h1 class="bold">Feedback Hub</h1>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'backend-dashboard' %}">Home</a>
            </li>
			<li class="breadcrumb-item">
                Others
            </li>
            <li class="breadcrumb-item active">
                <strong>Feedback Hub</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-md-3">
			<div class="ibox">
				<div class="ibox-title" style="padding-bottom:10px;">
					<center>
						<h1 class="bold" style="font-size: 120px;" id="feedback">{{ average }}</h1>
						<div class="emoji-rate" style="pointer-events: none;">
							<div class="inline-item">
								<label>
									<input class="radio" type="radio" name="rate" value="1" {% if shaded ==  1%} checked {% endif %} required/>
									<span>😠</span>
								</label>
							</div>
							<div class="inline-item">
								<label>
									<input class="radio" type="radio" name="rate" value="2" {% if shaded ==  2%} checked {% endif %} required/>
									<span>😕</span>
								</label>
							</div>
							<div class="inline-item">
								<label>
									<input class="radio" type="radio" name="rate" value="3" {% if shaded ==  3%} checked {% endif %} required/>
									<span>😶</span>
								</label>
							</div>
							<div class="inline-item">
								<label>
									<input class="radio" type="radio" name="rate" value="4" {% if shaded ==  4%} checked {% endif %} required/>
									<span>😊</span>
								</label>
							</div>
							<div class="inline-item">
								<label>
									<input class="radio" type="radio" name="rate" value="5" {% if shaded ==  5%} checked {% endif %} required/>
									<span>😍</span>
								</label>
							</div>
						</div>
						<h2 class="bold">based on <b>{{ total_stars }}</b> ratings</h2>
					</center>
				</div>
				<div class="ibox-content" style="padding-bottom:5px;">
					<label>😍</label>
					<div class="pull-right">
						<label>{{ star_percentage.star5 }}%</label>
					</div>
					<div class="progress">
						<div class="progress-bar" style="width: {{ star_percentage.star5 }}%" role="progressbar" aria-valuenow="{{ star_percentage.star5 }}" aria-valuemin="0" aria-valuemax="100"></div>
					</div>
                    <label>😊</label>
                    <div class="pull-right">
						<label>{{ star_percentage.star4 }}%</label>
					</div>
					<div class="progress">
						<div class="progress-bar" style="width: {{ star_percentage.star4 }}%" role="progressbar" aria-valuenow="{{ star_percentage.star4 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <label>😶</label>
                    <div class="pull-right">
						<label>{{ star_percentage.star3 }}%</label>
					</div>
					<div class="progress">
						<div class="progress-bar" style="width: {{ star_percentage.star3 }}%" role="progressbar" aria-valuenow="{{ star_percentage.star3 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <label>😕</label>
                    <div class="pull-right">
						<label>{{ star_percentage.star2 }}%</label>
					</div>
					<div class="progress">
						<div class="progress-bar" style="width: {{ star_percentage.star2 }}%" role="progressbar" aria-valuenow="{{ star_percentage.star2 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <label>😠</label>
                    <div class="pull-right">
						<label>{{ star_percentage.star1 }}%</label>
					</div>
					<div class="progress">
						<div class="progress-bar" style="width: {{ star_percentage.star1 }}%" role="progressbar" aria-valuenow="{{ star_percentage.star1 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
			</div>
		</div>
		<div class="col-md-9">
			<div class="ibox">
				<div class="ibox-content">
					<div class="table-responsive">
						<table id="feedback-table" class="table table-bordered table-hover" width="100%">
							<thead>
								<th>ACTION</th>
								<th>RATING</th>
								<th>COMMENT</th>
								<th>SENT BY</th>
								<th>RECEIVED</th>
							</thead>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    $('.confirmation').on('click', function () {
        return confirm('Are you sure you want to delete this feedback?');
    });

	Table();

    function Table(){
		$('#feedback-table').DataTable({
			'serverSide': true,
			'processing': true,
			'deferRender': true,
			'order': [[ 4, 'desc' ]],
			'lengthMenu': [ 25, 50, 100 ],
			'ajax': {
				'url': '/api/feedback/?format=datatables',
				'type': 'GET',
				'beforeSend': function (request) {
					request.setRequestHeader("Authorization", "Token 82b88a7bdac1ea3868361448927035e93b0dc19d")
				}
			},
			'fnCreatedRow': function (row, data, index) {
				$(row).attr('id', data['id']);
			},
			'columns': [
				{'data': 'id',
					'render': function(data, type, row, meta) {
						return "<a href='#' data-role='delete' data-id='"+ data + "'>Delete</a>"
					}
				},
				{'data': 'rate',
					'render': function(data, type, row, meta) {
						var template = '';
						if (data == 1) {
							template = '<span>😠</span>';
						} else if (data == 2) {
							template = '<span>😕</span>';
						} else if (data == 3) {
							template = '<span>😶</span>';
						} else if (data == 4) {
							template = '<span>😊</span>';
						} else if (data == 5) {
							template = '<span>😍</span>';
						}
						return template;
					},
					'className': 'text-center'
				},
				{'data': 'comment', 'className': 'text-center'},
				{'data': 'full_name', 'className': 'text-center',
					'name': 'emp.pi.user.last_name, emp.pi.user.first_name, emp.pi.user.middle_name',
				},
				{'data': 'date', 'className': 'text-right'},
			]
		});
	}
</script>
{% endblock %}
