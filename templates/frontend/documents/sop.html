{% extends 'layout.html' %}
{% load static %}
{% load tags %}
{% load crispy_forms_tags %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/adjustments.css' %}">
{% endblock %}
{% block content %}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-xs-8">
        <h1 class="bold">ISO (Department Wide)</h1>
        <ol class="breadcrumb">
            <li class="breadcrumb-item active">
                <a href="{% url 'backend-dashboard' %}">Home</a>
            </li>
            <li class="breadcrumb-item">
                Documents
            </li>
            <li class="breadcrumb-item">
                <strong>ISO (Department Wide)</strong>
            </li>
        </ol>
    </div>
    <div class="col-xs-4">
        <div class="title-action">
            {% if user|check_permission:'superadmin' %}
            <button class="btn btn-info" data-toggle="modal" data-target="#add"><i class="fas fa-plus"></i> Upload New File</button>
            {% endif %}
        </div>
    </div>
</div>
<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-md-3">
            <div class="ibox">
                <div class="ibox-title">
                    <p class="bold">FORM CLASSIFICATIONS</p>
                </div>
                <div class="ibox-content" style="padding: 0px !important;">
                    <div class="list-group">
                        {% for row in type %}
                        <a class="list-group-item type-{{ forloop.counter }} type" data-role="open-documents" data-id="{{ row.id }}" data-forloop="{{ forloop.counter }}">{{ row.name }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9">
             <div class="ibox">
                 <div class="ibox-content documents">
                 </div>
             </div>
        </div>
    </div>
</div>
<div class="modal" id="add" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-md">
        <div class="modal-content animated bounceInDown">
            <div class="modal-header bg-info">
	            <button type="button" class="close text-white" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
	            <h3 class="modal-title">NEW FILE</h3>
	            <small>Upload new file to publish.</small>
            </div>
            <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-body">
                {{ form.title|as_crispy_field }}
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label>Classes<span class="asteriskField">*</span></label>
                        <select class="form-control select" name="classes" required>
                            <option value="2">Standard Operating Procedures</option>
                        </select>
                    </div>
                    <div class="form-group col-sm-6">
                        <label>Classification<span class="asteriskField">*</span></label>
                        <select class="form-control select" name="classification" required>
                            <option></option>
                            {% for row in classification %}
                                <option value="{{ row.id }}">{{ row.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
	        	<div class="row">
		        	<div class="form-group col-md-12" style="margin-bottom:0;">
		        		<label>Filename</label>
						<div class="custom-file">
							<input type="file" name="filename" id="id_filename" class="form-control custom-file-input-single" required>
							<label for="id_filename" class="custom-file-label">Choose file..</label>
						</div>
		        	</div>
	        	</div>
                {{ form.status|as_crispy_field }}
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-info">Upload</button>
            </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function(){
        $('.type-1').addClass('active');
        $('.documents').load('/documents/display-sop-files/'+$('.type-1').data('id'));
    });

    $(document).on('click', 'a[data-role=open-documents]', function(){
        var id = $(this).data('id');
        var forloop = $(this).data('forloop');
        $('.type').each(function(){
            $(this).removeClass('active');
        });
        $('.type-'+forloop).addClass('active');
        $('.documents').load('/documents/display-sop-files/' + id);
    });
</script>
{% endblock %}